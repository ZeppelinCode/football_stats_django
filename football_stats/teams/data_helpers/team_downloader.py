import requests
from typing import List, Dict, Any, Generator
from teams.models import Team

cached_teams_data = [{'TeamId': 79, 'TeamName': '1. FC Nürnberg', 'ShortName': 'Nürnberg', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/1._FC_Nürnberg_logo.svg/1024px-1._FC_Nürnberg_logo.svg.png', 'TeamGroupName': None}, {'TeamId': 81, 'TeamName': '1. FSV Mainz 05', 'ShortName': 'Mainz 05', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Logo_Mainz_05.svg/1099px-Logo_Mainz_05.svg.png', 'TeamGroupName': None}, {'TeamId': 6, 'TeamName': 'Bayer Leverkusen', 'ShortName': 'Leverkusen', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/de/thumb/f/f7/Bayer_Leverkusen_Logo.svg/1280px-Bayer_Leverkusen_Logo.svg.png', 'TeamGroupName': None}, {'TeamId': 7, 'TeamName': 'Borussia Dortmund', 'ShortName': 'BVB', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Borussia_Dortmund_logo.svg/240px-Borussia_Dortmund_logo.svg.png', 'TeamGroupName': None}, {'TeamId': 87, 'TeamName': 'Borussia Mönchengladbach', 'ShortName': "M'gladbach", 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/81/Borussia_Mönchengladbach_logo.svg/630px-Borussia_Mönchengladbach_logo.svg.png', 'TeamGroupName': None}, {'TeamId': 91, 'TeamName': 'Eintracht Frankfurt', 'ShortName': 'Frankfurt', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Eintracht_Frankfurt_Logo.svg/1024px-Eintracht_Frankfurt_Logo.svg.png', 'TeamGroupName': None}, {'TeamId': 95, 'TeamName': 'FC Augsburg', 'ShortName': 'Augsburg', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/de/thumb/b/b5/Logo_FC_Augsburg.svg/785px-Logo_FC_Augsburg.svg.png', 'TeamGroupName': None}, {'TeamId': 40, 'TeamName': 'FC Bayern', 'ShortName': 'FCB', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1f/Logo_FC_Bayern_M%C3%BCnchen_%282002%E2%80%932017%29.svg/240px-Logo_FC_Bayern_M%C3%BCnchen_%282002%E2%80%932017%29.svg.png', 'TeamGroupName': None}, {'TeamId': 9, 'TeamName': 'FC Schalke 04', 'ShortName': 'Schalke', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/FC_Schalke_04_Logo.svg/1024px-FC_Schalke_04_Logo.svg.png',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            'TeamGroupName': None}, {'TeamId': 185, 'TeamName': 'Fortuna Düsseldorf', 'ShortName': 'Düsseldorf', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/94/Fortuna_D%C3%BCsseldorf.svg/150px-Fortuna_D%C3%BCsseldorf.svg.png', 'TeamGroupName': None}, {'TeamId': 55, 'TeamName': 'Hannover 96', 'ShortName': 'Hannover', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Hannover_96_Logo.svg/1162px-Hannover_96_Logo.svg.png', 'TeamGroupName': None}, {'TeamId': 54, 'TeamName': 'Hertha BSC', 'ShortName': 'Hertha', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/81/Hertha_BSC_Logo_2012.svg/2858px-Hertha_BSC_Logo_2012.svg.png', 'TeamGroupName': None}, {'TeamId': 1635, 'TeamName': 'RB Leipzig', 'ShortName': 'RBL Leipzig', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/en/thumb/0/04/RB_Leipzig_2014_logo.svg/20px-RB_Leipzig_2014_logo.svg.png', 'TeamGroupName': None}, {'TeamId': 112, 'TeamName': 'SC Freiburg', 'ShortName': 'Freiburg', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/de/thumb/f/f1/SC-Freiburg_Logo-neu.svg/739px-SC-Freiburg_Logo-neu.svg.png', 'TeamGroupName': None}, {'TeamId': 123, 'TeamName': 'TSG 1899 Hoffenheim', 'ShortName': 'Hoffenheim', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/6/64/TSG_Logo-Standard_4c.png', 'TeamGroupName': None}, {'TeamId': 16, 'TeamName': 'VfB Stuttgart', 'ShortName': 'Stuttgart', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/VfB_Stuttgart_1893_Logo.svg/921px-VfB_Stuttgart_1893_Logo.svg.png', 'TeamGroupName': None}, {'TeamId': 131, 'TeamName': 'VfL Wolfsburg', 'ShortName': 'VfL Wolfsburg', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/Logo-VfL-Wolfsburg.svg/1024px-Logo-VfL-Wolfsburg.svg.png', 'TeamGroupName': None}, {'TeamId': 134, 'TeamName': 'Werder Bremen', 'ShortName': 'Bremen', 'TeamIconUrl': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/SV-Werder-Bremen-Logo.svg/681px-SV-Werder-Bremen-Logo.svg.png', 'TeamGroupName': None}]


def pull_info_for_all_teams(year: int) -> List[Dict[Any, Any]]:
    # url = 'https://www.openligadb.de/api/getavailableteams/bl1/{}'.format(year)
    # headers = {'Content-Type': 'application/json'}
    # response = requests.get(url, headers=headers)

    # return response.json()
    return cached_teams_data


def valid_team(team: Dict[Any, Any]) -> bool:
    return team['TeamId'] and team['TeamName']


def clean_teams(teams: List[Dict[Any, Any]]) -> Generator:
    return (team for team in teams if valid_team(team))


def insert_into_database(teams: List[Dict[Any, Any]]):
    all_teams = clean_teams(pull_info_for_all_teams(2018))
    all_teams = (Team(external_id=team['TeamId'], team_name=team['TeamName'])
                 for team in all_teams)
    Team.objects.bulk_create(all_teams)
